-

# PHP - Les Variables : Enfin Comprendre leur VRAIE UtilitÃ© !

## ğŸ¯ Objectif PÃ©dagogique

**Passer de "je connais la syntaxe" Ã  "je sais QUAND et POURQUOI utiliser chaque type de variable"**

---

## ğŸ§  Le Paradigme Mental : Les Variables comme Outils

**Imaginez que vos variables sont des outils dans une boÃ®te :**

- **Variables locales** â†’ Outils personnels (seulement dans votre atelier)
- **Variables globales** â†’ Outils partagÃ©s (dans l'atelier principal)  
- **Variables de session** â†’ Dossier client (suivi pendant toute la visite)
- **Variables de cookie** â†’ Post-it sur le frigo (rappel pour plus tard)
- **Superglobales** â†’ Informations de l'entreprise (toujours disponibles)

---

## ğŸ”§ Variables Locales : Votre Espace Personnel

### ScÃ©nario RÃ©el : Calculatrice Personnelle

```php
<?php
// ğŸ¯ ANALOGIE : Votre calculatrice personnelle
function calculerTVA($prixHT) {
    // ğŸ› ï¸ OUTIL PERSONNEL : Seulement dans cette fonction
    $tauxTVA = 0.20;          // Variable locale
    $montantTVA = $prixHT * $tauxTVA;
    $prixTTC = $prixHT + $montantTVA;

    echo "ğŸ“Š Dans la fonction : TVA = $montantTVA â‚¬, Total = $prixTTC â‚¬\n";
    return $prixTTC;
}

$produit = 100;
$resultat = calculerTVA($produit);
echo "ğŸ’° Dehors : Prix produit = $produit â‚¬, RÃ©sultat = $resultat â‚¬\n";

// âŒ ESSAYEZ DE DÃ‰COMMENTER :
// echo $tauxTVA; // ERREUR ! Outil personnel inaccessible dehors
?>
```

**ğŸ’¡ Le POURQUOI :**

- **SÃ©curitÃ©** : Pas de modification accidentelle depuis l'extÃ©rieur
- **Isolation** : MÃªme nom de variable dans diffÃ©rentes fonctions = pas de conflit
- **MÃ©moire** : Nettoyage automatique quand la fonction se termine

---

## ğŸŒ Variables Globales : L'Atelier PartagÃ©

### ScÃ©nario RÃ©el : Configuration d'Application

```php
<?php
// ğŸ¯ ANALOGIE : Configuration de l'entreprise (partagÃ©e)
$nomEntreprise = "TechCorp";
$tvaParDefaut = 0.20;

function calculerFacture($montant) {
    // ğŸš« SANS PERMISSION : Ne voit pas les outils partagÃ©s
    // echo $nomEntreprise; // âŒ Erreur !

    // ğŸ”‘ AVEC PERMISSION SPÃ‰CIALE :
    global $nomEntreprise, $tvaParDefaut;

    $tva = $montant * $tvaParDefaut;
    echo "ğŸ¢ $nomEntreprise - Facture : $montant â‚¬ + $tva â‚¬ TVA\n";

    return $montant + $tva;
}

function afficherEntreprise() {
    global $nomEntreprise;
    echo "ğŸ‘‹ Bienvenue chez $nomEntreprise\n";
}

// Utilisation
afficherEntreprise();
calculerFacture(500);

// ğŸ’¡ MODIFICATION GLOBALE AFFECTE TOUT
$tvaParDefaut = 0.10; // Changement de politique TVA
echo "\nğŸ”„ AprÃ¨s changement de TVA :\n";
calculerFacture(500); // Utilise la nouvelle TVA
?>
```

**âš ï¸ Attention :** Les variables globales peuvent crÃ©er des effets de bord imprÃ©visibles !

---

## ğŸ“ Variables de Session : Le Dossier Client

### ScÃ©nario RÃ©el : Site E-commerce

```php
<?php
// ğŸ¯ ANALOGIE : Dossier client qui suit le visiteur
session_start();

// SIMULATION : Utilisateur se connecte
if (!isset($_SESSION['panier'])) {
    $_SESSION['panier'] = [];
    $_SESSION['utilisateur'] = "Jean Dupont";
    $_SESSION['connexion'] = date('Y-m-d H:i:s');
}

// Ajout au panier
$_SESSION['panier'][] = "iPhone 15";
$_SESSION['panier'][] = "AirPods";

echo "ğŸ›’ PANIER DE {$_SESSION['utilisateur']} :\n";
foreach ($_SESSION['panier'] as $index => $produit) {
    echo "   {$index}. {$produit}\n";
}

echo "â° ConnectÃ© depuis : {$_SESSION['connexion']}\n";

// ğŸ’¡ MÃŠME SI VOUS CHANGEZ DE PAGE, LE PANIER RESTE !
?>
```

**Page suivante (checkout.php) :**

```php
<?php
session_start();
echo "âœ… CHECKOUT - Bonjour {$_SESSION['utilisateur']}\n";
echo "ğŸ“¦ Vous avez " . count($_SESSION['panier']) . " articles\n";
?>
```

**ğŸ’¡ Avantage Session :** Les donnÃ©es persistent pendant toute la navigation !

---

## ğŸª Variables de Cookie : Le Post-it du Frigo

### ScÃ©nario RÃ©el : PrÃ©fÃ©rences Utilisateur

```php
<?php
// ğŸ¯ ANALOGIE : Post-it sur le frigo du navigateur
if (!isset($_COOKIE['theme'])) {
    // Premier visite - dÃ©finir les prÃ©fÃ©rences
    setcookie('theme', 'sombre', time() + (30 * 24 * 3600)); // 30 jours
    setcookie('langue', 'fr', time() + (30 * 24 * 3600));
    echo "ğŸ¨ PrÃ©fÃ©rences dÃ©finies pour la premiÃ¨re fois\n";
} else {
    // Visite suivante - lire les prÃ©fÃ©rences
    echo "ğŸ‘‹ Bon retour ! Vous prÃ©fÃ©rez :\n";
    echo "   ThÃ¨me : {$_COOKIE['theme']}\n";
    echo "   Langue : {$_COOKIE['langue']}\n";
}

// ğŸ’¡ EXEMPLE RÃ‰EL : Personnalisation d'interface
if (isset($_COOKIE['theme']) && $_COOKIE['theme'] == 'sombre') {
    echo "ğŸŒ™ Application du thÃ¨me sombre...\n";
} else {
    echo "â˜€ï¸ Application du thÃ¨me clair...\n";
}
?>
```

**ğŸ”„ RafraÃ®chissez la page pour voir la diffÃ©rence !**

---

## ğŸ“Š Superglobales : Les Informations de l'Entreprise

### ScÃ©nario RÃ©el : SystÃ¨me de Logs et Analytics

```php
<?php
// ğŸ¯ ANALOGIE : Tableau de bord de l'entreprise
echo "ğŸ“Š ANALYTICS DU VISITEUR :\n";
echo "------------------------\n";

// $_SERVER : Infos techniques
echo "ğŸŒ Navigateur : {$_SERVER['HTTP_USER_AGENT']}\n";
echo "ğŸ“ IP : {$_SERVER['REMOTE_ADDR']}\n";
echo "ğŸš€ Page : {$_SERVER['PHP_SELF']}\n";

// $_GET : ParamÃ¨tres URL (ex: page.php?produit=iphone&categorie=tech)
if (isset($_GET['recherche'])) {
    echo "ğŸ” Recherche : {$_GET['recherche']}\n";
}

// $_POST : Formulaire de contact
if ($_SERVER['REQUEST_METHOD'] == 'POST') {
    echo "ğŸ“§ Message reÃ§u de : {$_POST['email']}\n";
}

// $_FILES : Upload de documents
if (isset($_FILES['cv'])) {
    echo "ğŸ“„ CV reÃ§u : {$_FILES['cv']['name']}\n";
}

echo "------------------------\n";
?>
```

---

## ğŸ¯ Exercice Pratique : SystÃ¨me d'Authentification Complet

```php
<?php
session_start();

// SIMULATION BASE DE DONNÃ‰ES
$utilisateurs = [
    'admin' => '1234',
    'user' => 'password'
];

// TRAITEMENT CONNEXION
if ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['login'])) {
    $username = $_POST['username'];
    $password = $_POST['password'];

    if (isset($utilisateurs[$username]) && $utilisateurs[$username] == $password) {
        // âœ… CONNEXION RÃ‰USSIE
        $_SESSION['user'] = $username;
        $_SESSION['login_time'] = time();
        setcookie('dernier_user', $username, time() + (365 * 24 * 3600)); // 1 an

        echo "ğŸ‰ Connexion rÃ©ussie ! Redirection...\n";
    } else {
        echo "âŒ Identifiants incorrects\n";
    }
}

// AFFICHAGE STATUT
if (isset($_SESSION['user'])) {
    $temps_session = time() - $_SESSION['login_time'];
    echo "ğŸ‘‹ Bonjour {$_SESSION['user']} ! ConnectÃ© depuis $temps_session secondes\n";

    if (isset($_COOKIE['dernier_user'])) {
        echo "ğŸª DerniÃ¨re connexion sauvegardÃ©e : {$_COOKIE['dernier_user']}\n";
    }
} else {
    echo "ğŸ”’ Veuillez vous connecter\n";
}

// DÃ‰CONNEXION
if (isset($_GET['logout'])) {
    session_destroy();
    setcookie('dernier_user', '', time() - 3600);
    echo "ğŸ‘‹ DÃ©connexion rÃ©ussie !\n";
}
?>

<!-- FORMULAIRE DE CONNEXION -->
<form method="post">
    <input type="text" name="username" placeholder="Utilisateur" value="<?= $_COOKIE['dernier_user'] ?? '' ?>">
    <input type="password" name="password" placeholder="Mot de passe">
    <button type="submit" name="login">Se connecter</button>
</form>

<a href="?logout=1">Se dÃ©connecter</a>
```

---

## ğŸ“‹ Guide de Choix : Quelle Variable Utiliser ?

| Situation             | Type de Variable | Pourquoi                     |
| --------------------- | ---------------- | ---------------------------- |
| **Calcul temporaire** | ğŸ”§ Locale        | Isolation, sÃ©curitÃ©, mÃ©moire |
| **Configuration app** | ğŸŒ Globale       | AccÃ¨s depuis partout         |
| **Panier e-commerce** | ğŸ“ Session       | Persistance navigation       |
| **PrÃ©fÃ©rences user**  | ğŸª Cookie        | Souvenir entre visites       |
| **Infos requÃªte**     | ğŸ“Š Superglobales | DonnÃ©es HTTP automatiques    |

---

## âš ï¸ Les PiÃ¨ges Ã  Ã‰viter

### PiÃ¨ge 1 : Variables globales modifiÃ©es partout

```php
// âŒ DANGEREUX
global $config;
$config = "nouvelle valeur"; // ModifiÃ© partout !

// âœ… MEILLEUR : Constantes ou encapsulation
define('CONFIG', 'valeur stable');
```

### PiÃ¨ge 2 : Sessions non dÃ©marrÃ©es

```php
// âŒ OUBLI FRÃ‰QUENT
$_SESSION['user'] = "Jean"; // Erreur si pas de session_start()

// âœ… TOUJOURS COMMENCER PAR
session_start();
$_SESSION['user'] = "Jean";
```

### PiÃ¨ge 3 : Cookies avec valeurs sensibles

```php
// âŒ DANGEREUX
setcookie('mot_de_passe', '1234'); // StockÃ© en clair chez le client !

// âœ… SÃ‰CURISÃ‰ : Sessions pour donnÃ©es sensibles
$_SESSION['user_id'] = 123; // StockÃ© cÃ´tÃ© serveur
```

---

## ğŸš€ Pour Aller Plus Loir

**Pattern avancÃ© : Service Container**

```php
<?php
class Configuration {
    private static $instance;
    private $settings = [];

    public static function getInstance() {
        if (!self::$instance) {
            self::$instance = new self();
        }
        return self::$instance;
    }

    public function set($key, $value) {
        $this->settings[$key] = $value;
    }

    public function get($key) {
        return $this->settings[$key] ?? null;
    }
}

// Utilisation Ã©lÃ©gante
$config = Configuration::getInstance();
$config->set('database.host', 'localhost');
echo $config->get('database.host');
?>
```



### Exemple : GÃ©rer donnÃ©es utilisateur sessions PHP

Script PHP rend formulaire HTML. DonnÃ©es formulaire utilisÃ©es crÃ©er trois variables session. Hyperlien mÃ¨ne navigateur autre page, lit variables session.

Enregistrez code "test.php" dossier racine, ouvrez navigateur. Entrez donnÃ©es, appuyez Soumettre.

```html
<html>
<head>
   <title>PHP Sessions : Comment utiliser $_SESSION pour gÃ©rer les donnÃ©es utilisateur</title>
   <meta name="keywords" content="PHP Sessions, PHP $_SESSION, GÃ©rer donnÃ©es utilisateur en PHP, PHP session_start, variables session, tutoriel session PHP">
</head>
<body>
   <form action="<?php echo $_SERVER['PHP_SELF'];?>" method="post">
      <h3>ID utilisateur : <input type="text" name="ID"/></h3>
      <h3>Votre nom : <input type="text" name="name"/></h3>
      <h3>Entrez Ã¢ge : <input type="text" name="age"/></h3>
      <input type="submit" value="Soumettre"/>
   </form>
   <?php
      session_start();
      if ($_SERVER["REQUEST_METHOD"] == "POST") {
         $_SESSION['UserID'] = $_POST['ID'];
         $_SESSION['Name'] = $_POST['name'];
         $_SESSION['age'] = $_POST['age'];
      }
      echo "Variables de session suivantes crÃ©Ã©es : \n";

      foreach ($_SESSION as $key => $val)
         echo "<h3>" . $key . " => " . $val . "</h3>";
      echo "<br/>" . '<a href="hello.php">Cliquez ici</a>';
   ?>
</body>
</html>
```

Cliquez "Soumettre", affichera liste toutes variables session crÃ©Ã©es :

![PHP  SESSION 1](https://www.tutorialspoint.com/php/images/php_%24_session_1.gif)

Ensuite, script suivant fichier "hello.php" enregistrez-le.

```php
<?php
   session_start();
   echo "<h2>Variables de session suivantes lues :</h2>";
   foreach ($_SESSION as $key => $val)
      echo "<h3>" . $key . " => " . $val . "</h3>";
?>
```

Maintenant, suivez lien page "test.php" naviguer "hello.php". Affichera variables session lues :

![PHP  SESSION 2](https://www.tutorialspoint.com/php/images/php_%24_session_2.jpg) ```