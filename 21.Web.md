# PHP - Concepts web

PHP est un langage de script côté serveur utilisé pour créer des pages web dynamiques. C’est l’un des langages de programmation les plus populaires pour le développement web. Ce chapitre vise à vous familiariser avec certains concepts importants du développement d’applications web en utilisant PHP.

Une application web est une collection de pages web. Une page web est principalement créée avec des balises HTML. HTML consiste en différentes balises HTML nécessaires pour définir l’apparence des éléments de page comme le texte, l’image, le tableau, etc. Donc, HTML crée essentiellement une page web statique.

Une application web est hébergée sur un serveur HTTP avec le module PHP installé. Le navigateur agit comme un client HTTP, pour établir une communication avec le serveur, en suivant le protocole HTTP.

![Concepts web PHP](https://www.tutorialspoint.com/php/images/php_web_concepts.jpg)

## Comment ajouter du contenu dynamique sur une page web ?

Pour ajouter du contenu dynamique à une page web, il y a deux possibilités.

JavaScript est un langage de script côté client, qui peut accéder au modèle d’objet de document HTML et rendre du contenu dynamique sur le navigateur client. Le code JavaScript peut être intégré dans une page HTML.

Le navigateur peut collecter des données de l’utilisateur sous forme d’éléments de formulaire HTML et les envoyer à un serveur HTTP pour traitement. PHP est un langage de traitement côté serveur largement utilisé. Le script PHP peut aussi être intégré dans une page HTML.

### Exemple

Dans le script suivant, le code JavaScript intégré dans HTML rend la date actuelle selon le navigateur client, et le code PHP affiche la date actuelle selon le serveur où ce script est hébergé.

```php
<!DOCTYPE html>
<html>
<body>
   <script type="text/JavaScript">
      document.write("Date du client : " + Date() + "\n");
   </script>
   <?php
      date_default_timezone_set("Asia/Calcutta");
      echo "Date du serveur : " . date("Y-m-d") . "\n";
      echo "L’heure est " . date("h:i:sa");
   ?>
</body>
</html>
```

PHP peut intercepter et traiter les données des formulaires HTML. Cela permet de collecter des informations des utilisateurs. Le chapitre suivant discute de la gestion des formulaires en PHP.

PHP peut être utilisé pour interagir avec des bases de données comme MySQL et PostgreSQL. Cela permet de stocker et récupérer des données de la base, et de peupler dynamiquement les pages web ou d’alimenter les applications web. PHP inclut les extensions mysql, mysqli et PDO pour la gestion des bases de données.

PHP peut gérer les données reçues du client avec les méthodes HTTP GET et POST. Nous discuterons en détail comment PHP gère les méthodes GET/POST dans l’un des chapitres suivants.

HTTP est un protocole sans état. Cependant, il permet de maintenir des sessions et des cookies sur le serveur et le client respectivement. PHP peut être utilisé pour créer et gérer des sessions et des cookies. Les sessions permettent de suivre les utilisateurs individuels pendant qu’ils naviguent sur votre site web, tandis que les cookies permettent de stocker des informations sur l’ordinateur de l’utilisateur pour un usage ultérieur. Dans l’un des chapitres suivants, nous apprendrons comment PHP gère les sessions et les cookies.

PHP peut être utilisé pour uploader des fichiers sur votre serveur web. Cela permet de créer des applications web qui permettent aux utilisateurs d’uploader des fichiers, comme des images, des vidéos ou des documents.

Vous pouvez utiliser PHP pour créer une page de login pour votre site web. Quand l’utilisateur entre son nom d’utilisateur et son mot de passe, PHP peut vérifier la base de données pour voir si l’utilisateur est valide. Si valide, PHP peut logger l’utilisateur et le rediriger vers la page principale de votre site web.

## Identifier navigateur & plateforme

PHP crée des variables d’environnement utiles visibles dans la page phpinfo.php utilisée pour configurer l’environnement PHP.

L’une des variables d’environnement définies par PHP est HTTP_USER_AGENT qui identifie le navigateur et le système d’exploitation de l’utilisateur.

PHP fournit la fonction getenv() pour accéder à la valeur de toutes les variables d’environnement. Les informations contenues dans la variable d’environnement HTTP_USER_AGENT peuvent être utilisées pour créer du contenu dynamique approprié au navigateur.

### Exemple

L’exemple suivant démontre comment identifier un navigateur client et un système d’exploitation.

NOTE : La fonction preg_match() est discutée dans la session [Expressions régulières PHP](https://www.tutorialspoint.com/php/php_regular_expression.htm).

```php
<?php
   function getBrowser() { 
      $u_agent = $_SERVER['HTTP_USER_AGENT']; 
      $bname = 'Inconnu';
      $platform = 'Inconnu';
      $version = "";

      // D’abord obtenir la plateforme
      if (preg_match('/linux/i', $u_agent)) {
         $platform = 'linux';
      } elseif (preg_match('/macintosh|mac os x/i', $u_agent)) {
         $platform = 'mac';
      } elseif (preg_match('/windows|win32/i', $u_agent)) {
         $platform = 'windows';
      }

      // Ensuite obtenir le nom de l’useragent séparément et pour bonne raison
      if (preg_match('/MSIE/i', $u_agent) && !preg_match('/Opera/i', $u_agent)) {
         $bname = 'Internet Explorer';
         $ub = "MSIE";
      } elseif (preg_match('/Firefox/i', $u_agent)) {
         $bname = 'Mozilla Firefox';
         $ub = "Firefox";
      } elseif (preg_match('/Chrome/i', $u_agent)) {
         $bname = 'Google Chrome';
         $ub = "Chrome";
      } elseif (preg_match('/Safari/i', $u_agent)) {
         $bname = 'Apple Safari';
         $ub = "Safari";
      } elseif (preg_match('/Opera/i', $u_agent)) {
         $bname = 'Opera';
         $ub = "Opera";
      } elseif (preg_match('/Netscape/i', $u_agent)) {
         $bname = 'Netscape';
         $ub = "Netscape";
      }

      // Enfin obtenir le numéro de version correct
      $known = array('Version', $ub, 'autre');
      $pattern = '#(?<browser>' . join('|', $known) . ')
         [/ ]+(?<version>[0-9.|a-zA-Z.]*)#';

      if (!preg_match_all($pattern, $u_agent, $matches)) {
         // pas de numéro correspondant, continue
      }

      // Voir combien on en a
      $i = count($matches['browser']);

      if ($i != 1) {
         // On en aura deux car on n’utilise pas encore 'autre'

         // Voir si version avant ou après nom
         if (strripos($u_agent, "Version") < strripos($u_agent, $ub)) {
            $version = $matches['version'][0];
         } else {
            $version = $matches['version'][1];
         }
      } else {
         $version = $matches['version'][0];
      }

      // Vérifier si on a un numéro
      if ($version == null || $version == "") { $version = "?"; }
         return array(
            'userAgent' => $u_agent,
            'name'      => $bname,
            'version'   => $version,
            'platform'  => $platform,
            'pattern'   => $pattern
         );
   }

   // Essayez maintenant
   $ua = getBrowser();
   $yourbrowser = "Votre navigateur : " . $ua['name'] . " " . $ua['version'] .
   " sur " . $ua['platform'] . " rapporte : <br >" . $ua['userAgent'];

   print_r($yourbrowser);
?>
```

Cela produit résultat suivant sur ma machine. Résultat peut différer selon ce que vous utilisez.

Cela produira résultat suivant :

```
Votre navigateur : Google Chrome 54.0.2840.99 sur windows rapporte : 
Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) 
   Chrome/54.0.2840.99 Safari/537.36
```

## Afficher images aléatoirement

Fonction PHP rand() utilisée générer nombre aléatoire. Fonction génère nombres dans plage donnée. Générateur nombres aléatoires semé éviter pattern régulier nombres générés. Atteint utilisant fonction srand() spécifie numéro semence argument.

### Exemple

Exemple suivant démontre comment afficher image différente chaque fois parmi quatre images :

```php
<?php
   srand(microtime() * 1000000);
   $num = rand(1, 4);

   switch ($num) {
      case 1: $image_file = "/php/images/php_image_sample_1.jpg";
         break;

      case 2: $image_file = "/php/images/php_image_sample_2.jpg";
         break;

      case 3: $image_file = "/php/images/php_image_sample_3.jpg";
         break;

      case 4: $image_file = "/php/images/php_image_sample_4.jpg";
         break;
   }
   echo "Image aléatoire : <img src=$image_file />";
?>
```

Cela produira résultat suivant :

![Afficher image aléatoirement](https://www.tutorialspoint.com/php/images/php_image_sample_3.jpg)

## Utiliser formulaires HTML

Chose importante remarquer traitant formulaires HTML PHP tout élément formulaire page HTML automatiquement disponible scripts PHP.

### Exemple

Essayez exemple suivant mettant code source script test.php.

```php
<?php
   if (isset($_POST["name"])) {
      echo "Bienvenue " . $_POST["name"] . "<br />";
   }
?>
<html>
<body>
   <form action="<?php echo $_SERVER['PHP_SELF'];?>" method="post">
      Entrez votre nom : <input type="text" name="name" />
      <input type="submit" />
   </form>
</body>
</html>
```

Cela produira résultat suivant :

Entrez votre nom : [champ texte] [bouton soumettre]

## Gestion GET

Données envoyées GET ajoutées à URL sous forme chaîne requête. PHP stocke données tableau associatif superglobal $_GET.

### Exemple

Lien : hello.php?nom=Marie&age=30

Dans "hello.php" :

```php
Bonjour <?php echo $_GET["nom"]; ?>.<br />
Vous avez <?php echo $_GET["age"]; ?> ans.
```

Sortie :

```
Bonjour Marie.
Vous avez 30 ans.
```

## Gestion POST

Données POST envoyées corps requête, pas visibles URL. PHP stocke données $_POST.

### Exemple formulaire POST

```php
<form action="hello.php" method="post">
   Entrez votre nom : <input type="text" name="nom" />
   Entrez votre âge : <input type="text" name="age" />
   <input type="submit" />
</form>
```

Dans "hello.php" :

```php
Bonjour <?php echo $_POST["nom"]; ?>.<br />
Vous avez <?php echo $_POST["age"]; ?> ans.
```

## Gestion formulaires PHP

PHP peut gérer données formulaires envoyées GET ou POST.

### Exemple formulaire

```php
<?php
   if (isset($_REQUEST['nom'])) {
      echo "Bonjour " . $_REQUEST['nom'];
   }
?>
<form method="post" action="<?php echo $_SERVER['PHP_SELF']; ?>">
   Nom : <input type="text" name="nom" />
   <input type="submit" />
</form>
```

## Validation données formulaire

Validez données côté serveur pour sécurité.

### Exemple validation

```php
<?php
   if ($_SERVER["REQUEST_METHOD"] == "POST") {
      $nom = htmlspecialchars($_REQUEST['nom']);
      if (empty($nom)) {
         echo "Nom vide.";
      } else {
         echo $nom;
      }
   }
?>
```

## Champs requis

Utilisez `required` dans HTML pour champs obligatoires.

### Exemple

```html
<form method="post" action="<?php echo $_SERVER['PHP_SELF']; ?>">
   Nom : <input type="text" name="nom" required />
   <input type="submit" />
</form>
```

## Garder valeurs formulaire après soumission

```php
<?php
   if ($_SERVER["REQUEST_METHOD"] == "POST") {
      $nom = htmlspecialchars($_REQUEST['nom']);
   }
?>
<input type="text" name="nom" value="<?php echo $nom; ?>" />
```

## Validation email

Utilisez `filter_var()` avec FILTER_VALIDATE_EMAIL.

### Exemple

```php
<?php
   $email = htmlspecialchars($_REQUEST['email']);
   if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
      echo "Email invalide.";
   } else {
      echo $email;
   }
?>
```

## Validation URL

FILTER_VALIDATE_URL.

### Exemple

```php
<?php
   $url = htmlspecialchars($_REQUEST['url']);
   if (!filter_var($url, FILTER_VALIDATE_URL)) {
      echo "URL invalide.";
   } else {
      echo $url;
   }
?>
```

## Validation nombre

FILTER_VALIDATE_INT.

### Exemple

```php
<?php
   $age = htmlspecialchars($_REQUEST['age']);
   if (!filter_var($age, FILTER_VALIDATE_INT)) {
      echo "Âge invalide.";
   } else {
      echo $age;
   }
?>
```

## Validation IP

FILTER_VALIDATE_IP.

### Exemple

```php
<?php
   $ip = htmlspecialchars($_REQUEST['ip']);
   if (!filter_var($ip, FILTER_VALIDATE_IP)) {
      echo "IP invalide.";
   } else {
      echo $ip;
   }
?>
```

## Sanitisation données

Utilisez `filter_var()` pour nettoyer.

### Sanitiser chaîne

FILTER_SANITIZE_STRING (obsolète PHP 8.1).

### Sanitiser email

FILTER_SANITIZE_EMAIL.

### Exemple

```php
<?php
   $a = 'abc def@xyz.com';
   $sa = filter_var($a, FILTER_SANITIZE_EMAIL);
   echo "$sa";
?>
```

Sortie : `abcdef@xyz.com`

### Sanitiser URL

FILTER_SANITIZE_URL.

### Exemple

```php
<?php
   $a = "http://example.c o m";
   $sa = filter_var($a, FILTER_SANITIZE_URL);
   echo "$sa";
?>
```

Sortie : `http://example.com`

## mysqli_real_escape_string()

Échappe caractères spéciaux chaînes avant utilisation SQL pour prévenir injection.

```
$conn = new mysqli("localhost", "username", "password", "database");
$user_input = "O'Reilly";
$safe_input = $conn->real_escape_string($user_input);
$query = "SELECT * FROM users WHERE last_name = '$safe_input'";
```

---

# PHP - Post-Redirect-Get (PRG)

En PHP, PRG signifie "Post/Redirect/Get". Technique couramment utilisée conçue empêcher resoumission formulaire après soumission. Implémentez facilement cette technique PHP éviter soumissions formulaire dupliquées.

Habituellement formulaire HTML envoie données serveur avec méthode POST. Script serveur récupère données traitement ultérieur comme ajouter nouvel enregistrement base données backend, exécuter requête récupérer données. Si utilisateur rafraîchit accidentellement navigateur, possibilité mêmes données formulaire resoumises, menant perte intégrité données. Approche PRG PHP aide éviter piège.

## Exemple

Pour commencer, considérons script PHP suivant rend formulaire HTML simple, soumet lui-même méthode POST. Utilisateur remplit données soumet, script backend récupère données, rend résultat, revient afficher formulaire vide nouveau.

```php
<?php
   if (isset($_POST["submit"])) {
      if ($_SERVER["REQUEST_METHOD"] == "POST")
         echo "Prénom : " . $_REQUEST['first_name'] . " " . "Nom : " . $_REQUEST['last_name'] . "";
   }
?>

<html>
<body>
   <form action="<?php echo $_SERVER['PHP_SELF'];?>" method="post">
      Prénom : <input type="text" name="first_name">  <br/>
      Nom : <input type="text" name="last_name" />
      <button type="submit" name="submit">Soumettre</button>
   </form>
</body>
</html>
```

Supposant serveur exécuté, script ci-dessus placé dossier racine documents, visité navigateur.

Remplissez données soumettez. Navigateur écho résultat, re-rend formulaire. Maintenant si essayez rafraîchir page navigateur, avertissement apparaît comme ci-dessous :

![PHP PRG 1](https://www.tutorialspoint.com/php/images/php_prg_1.jpg)

Si appuyez Continuer, mêmes données postées nouveau.

Problème compris figure suivante :

![PHP PRG 2](https://www.tutorialspoint.com/php/images/php_prg_2.jpg)

Étapes suivantes prises script PHP éviter problème :

- Script avant formulaire HTML démarre nouvelle session.
- Vérifie si formulaire soumis méthode POST.
- Si oui, stocke données formulaire variables session
- Redirige navigateur page résultat. Notre cas, même page. Avec commande exit, terminer script assurer plus code exécuté.
- Si PHP trouve méthode REQUEST pas POST, vérifie si variables session définies. Si oui, rendues avec copie fraîche formulaire.
- Maintenant même si formulaire rafraîchi, évité succès possibilité resoumission.

## Exemple

Voici code PHP utilise technique PRG :

```php
<?php
   session_start();
   if (isset($_POST["submit"])) {
      $_SESSION['fname'] = $_POST['first_name'];
      $_SESSION['lname'] = $_POST['last_name']; 
      header("Location: hello.php");
      exit;
   }
   if (isset($_SESSION["fname"])) {
      echo "Prénom : " . $_SESSION['fname'] . " " . "Nom : " . $_SESSION['lname'] . "";
      unset($_SESSION["fname"]); unset($_SESSION["lname"]);
   }
?>

<html>
<body>
   <form action="<?php echo $_SERVER['PHP_SELF'];?>" method="post">
      Prénom : <input type="text" name="first_name">  <br />
      Nom : <input type="text" name="last_name" />
      <button type="submit" name="submit">Soumettre</button>
   </form>
</body>
</html>
```

---

# PHP - Messages flash

Affichage messages en application web PHP désigne technique fait certains messages popup fenêtre navigateur utilisateur recevoir feedback application. Pouvoir donner utilisateur feedback significatif interactions principe design important, donne meilleure expérience utilisateur.

Application web PHP, utilisons données session afficher messages concernant succès ou échec certaine action, notifications ou avertissements, temps temps garder utilisateur informé.

Message flash permet créer message page afficher une fois autre page. Transférer message page autre, utilisez superglobale $_SESSION.

Commencer, ajoutez variable $_SESSION comme suit :

```php
<?php
   session_start();
   $_SESSION['flash_message'] = "Bonjour le monde";
?>
```

Plus tard, naviguez autre page, récupérez message flash variable $_SESSION assignez variable. Puis, affichez message supprimez message $_SESSION :

```php
<?php
   session_start();
   if (isset($_SESSION['flash_message'])) {
      $message = $_SESSION['flash_message'];
      unset($_SESSION['flash_message']);
      echo $message;
   }
?>
```

Généraliser idée basique gérer messages flash, écrivons fonction ajoute message $_SESSION :

```php
session_start();
function create_flash_message(string $name, string $message): void {

   // Supprime message existant nom
   if (isset($_SESSION[FLASH][$name])) {
      unset($_SESSION[FLASH][$name]);
   }
   // Ajoute message session
   $_SESSION[FLASH][$name] = ['message' => $message]; 
}
```

Aussi fonction lit message, affiche navigateur, supprime $_SESSION.

```php
function display_flash_message(string $name): void {
   if (!isset($_SESSION[FLASH][$name])) {
      return;
   }

   // Récupère message session
   $flash_message = $_SESSION[FLASH][$name];

   // Supprime message flash
   unset($_SESSION[FLASH][$name]);

   // Affiche message flash
   echo format_flash_message($flash_message);
}
```

Fonction format_flash_message() applique formatage désiré chaîne obtenue règles CSS appropriées.

S’il y a plus messages flashés application, récupérés flashés exemple suivant :

```php
function display_all_flash_messages(): void {
   if (!isset($_SESSION[FLASH])) {
      return;
   }

   // Récupère messages flash
   $flash_messages = $_SESSION[FLASH];

   // Supprime tous messages flash
   unset($_SESSION[FLASH]);

   // Affiche tous messages flash
   foreach ($flash_messages as $flash_message) {
      echo format_flash_message($flash_message);
   }
}
```

Utilisez fonction flash() suivante créer, formater afficher messages

```php
function flash(string $name = '', string $message = ''): void {
   if ($name !== '' && $message !== '') {
      create_flash_message($name, $message);
   } 
   elseif ($name !== '' && $message === '') {
      display_flash_message($name);        // Affiche message flash
   } elseif ($name === '' && $message === '' ) {
      display_all_flash_messages();     // Affiche tous messages flash
   }
}
```

Implémenter méthode ci-dessus, appelez fonction flash() première page.

```
flash('premier', 'Bonjour le monde');
```

Naviguez autre page appelez fonction flash() récupérer afficher message :

```
flash('premier');
```

Mécanisme utilisation messages flash généralement employé page inscription rediriger utilisateurs page login message bienvenue après inscription.
