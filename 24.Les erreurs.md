# PHP - Gestion des erreurs et dÃ©bogage

## ğŸ¯ Comprendre les erreurs en PHP

### Qu'est-ce qu'une erreur en programmation ?

Imaginez que vous Ãªtes en train de cuisiner ğŸ³. Une erreur en programmation, c'est comme :

- **Oublier un ingrÃ©dient** â†’ Le plat ne sera pas rÃ©ussi
- **Mettre trop de sel** â†’ Le plat devient immangeable
- **BrÃ»ler la prÃ©paration** â†’ RÃ©sultat catastrophique

En PHP, les erreurs suivent la mÃªme logique ! Voyons comment les Ã©viter.

---

## ğŸš¨ Les mÃ©thodes de base pour gÃ©rer les erreurs

### 1. La fonction `die()` - L'arrÃªt d'urgence ğŸ›‘

**Analogie :** C'est comme couper le courant Ã©lectrique quand il y a un danger.

```php
<?php
// ScÃ©nario : Vous voulez lire un livre, mais il n'existe pas
$livre = "mon_livre.txt";

// VÃ©rification SIMPLE avec die()
if (!file_exists($livre)) {
    die("ğŸš« DÃ©solÃ©, le livre '$livre' n'existe pas dans la bibliothÃ¨que !");
}

// Si on arrive ici, c'est que le livre existe
echo "ğŸ“– Super ! Je peux lire le livre : $livre";
?>
```

**Que se passe-t-il ?**

1. PHP vÃ©rifie si le fichier existe
2. S'il n'existe pas â†’ `die()` arrÃªte TOUT le programme et affiche le message
3. S'il existe â†’ le programme continue

**Ã€ vos tests !** ğŸ§ª
CrÃ©ez ce code et :

- Testez avec un fichier qui n'existe pas â†’ vous verrez le message d'erreur
- CrÃ©ez le fichier et testez Ã  nouveau â†’ vous verrez le message de succÃ¨s

---

### 2. Les gestionnaires d'erreurs personnalisÃ©s - La mÃ©thode PRO ğŸ¯

**ProblÃ¨me avec `die()`** : C'est trop brutal ! Tout s'arrÃªte immÃ©diatement.

**Solution** : CrÃ©ons notre propre systÃ¨me de gestion des erreurs.

```php
<?php
// CrÃ©ons notre "systÃ¨me d'alarme" personnalisÃ©
function monSystemeAlerte($typeErreur, $message, $fichier, $ligne) {

    // Traduisons les codes d'erreur en franÃ§ais
    $types = [
        1 => 'ERREUR GRAVE',      // E_ERROR
        2 => 'AVERTISSEMENT',     // E_WARNING  
        8 => 'NOTICE',            // E_NOTICE
    ];

    $typeLisible = $types[$typeErreur] ?? 'ERREUR INCONNUE';

    // CrÃ©ons un message clair
    $messageClair = "ğŸš¨ $typeLisible : $message";
    $messageClair .= " (dans $fichier Ã  la ligne $ligne)";

    // Affichons le message
    echo "<div style='border: 2px solid red; padding: 10px; margin: 10px;'>";
    echo $messageClair;
    echo "</div>";

    // Ã‰crivons aussi dans un journal (comme un carnet de bord)
    error_log($messageClair);
}

// Activons notre systÃ¨me d'alarme
set_error_handler("monSystemeAlerte");

// Testons notre systÃ¨me avec diffÃ©rentes erreurs

echo "<h3>Test 1 : Variable non dÃ©finie</h3>";
echo $variableInexistante;  // GÃ©nÃ¨re une NOTICE

echo "<h3>Test 2 : Division par zÃ©ro</h3>";
$resultat = 10 / 0;  // GÃ©nÃ¨re un AVERTISSEMENT

echo "<h3>Test 3 : Fichier inexistant</h3>";
$fichier = fopen("fichier_qui_n_existe_pas.txt", "r");  // GÃ©nÃ¨re un AVERTISSEMENT

echo "<h3>Le programme continue malgrÃ© les erreurs ! ğŸ‰</h3>";
?>
```

**Explication dÃ©taillÃ©e :**

1. **`monSystemeAlerte()`** est NOTRE fonction qui sera appelÃ©e Ã  chaque erreur
2. **`set_error_handler()`** dit Ã  PHP : "Utilise MA fonction pour gÃ©rer les erreurs"
3. Quand une erreur arrive, PHP appelle NOTRE fonction au lieu de sa fonction par dÃ©faut

**Avantage** : Le programme ne s'arrÃªte pas ! Il continue en affichant des messages d'erreurs Ã©lÃ©gants.

---

## ğŸª Le grand cirque des exceptions PHP

**MÃ©taphore** : Les exceptions, c'est comme un systÃ¨me de courrier d'urgence :

- Quelqu'un lance une exception ("ProblÃ¨me !")
- Quelqu'un d'autre l'attrape et la traite ("Je m'en occupe !")

### Apprenons avec des exemples concrets :

### ğŸ§® Exemple 1 : Les problÃ¨mes de calcul

```php
<?php
function calculerDivision($nombre, $diviseur) {
    echo "<div style='border: 1px solid blue; padding: 10px; margin: 5px;'>";
    echo "ğŸ§® Je veux diviser $nombre par $diviseur...<br>";

    try {
        if ($diviseur == 0) {
            throw new Exception("âŒ Impossible de diviser par zÃ©ro !");
        }

        $resultat = $nombre / $diviseur;
        echo "âœ… RÃ©sultat : $resultat";

    } catch (Exception $e) {
        echo $e->getMessage();
    }

    echo "</div>";
}

// Testons notre fonction
calculerDivision(10, 2);   // âœ… Ã‡a marche
calculerDivision(10, 0);   // âŒ Erreur attrapÃ©e
calculerDivision(8, 4);    // âœ… Ã‡a marche encore !
?>
```

**Que s'est-il passÃ© ?**

- `throw new Exception()` â†’ "Je lance un problÃ¨me"
- `catch (Exception $e)` â†’ "J'attrape le problÃ¨me"
- Le programme continue mÃªme aprÃ¨s l'erreur !

### ğŸ§® Exemple 2 : Division avec des classes spÃ©cialisÃ©es

```php
<?php
class Cuisinier {
    public function diviserGateau($parts, $personnes) {
        echo "ğŸ° Je veux diviser le gÃ¢teau en $parts parts pour $personnes personnes<br>";

        try {
            if ($personnes <= 0) {
                throw new DivisionByZeroError("ğŸ¤” Il n'y a personne pour manger le gÃ¢teau !");
            }

            if ($parts < $personnes) {
                throw new ArithmeticError("ğŸ˜± Il n'y a pas assez de parts de gÃ¢teau !");
            }

            $partsParPersonne = $parts / $personnes;
            echo "âœ… Chacun aura " . number_format($partsParPersonne, 2) . " parts<br>";

        } catch (DivisionByZeroError $e) {
            echo "<span style='color: red;'>" . $e->getMessage() . "</span><br>";
        } catch (ArithmeticError $e) {
            echo "<span style='color: orange;'>" . $e->getMessage() . "</span><br>";
        }

        echo "---<br>";
    }
}

// Testons notre cuisinier
$chef = new Cuisinier();
$chef->diviserGateau(8, 4);    // âœ… Parfait
$chef->diviserGateau(8, 0);    // âŒ Personne pour manger
$chef->diviserGateau(2, 5);    // âŒ Pas assez de parts
?>
```

**Exercice pour vous** ğŸ¯ : 
Modifiez les nombres et observez les diffÃ©rents messages d'erreur !

---

## ğŸ”§ Le dÃ©bogage : Devenez un dÃ©tective du code ğŸ•µï¸

### Configuration de base pour voir les erreurs

```php
<?php
// Activez CES lignes au dÃ©but de vos scripts pendant le dÃ©veloppement
ini_set('display_errors', 1);
ini_set('display_startup_errors', 1);
error_reporting(E_ALL);

echo "ğŸ” Mode dÃ©tective activÃ© ! Je vois maintenant toutes les erreurs.<br>";

// CrÃ©ons des outils de dÃ©bogage amusants
class DetectiveCode {

    public static function examiner($variable, $nom = "Variable mystÃ¨re") {
        echo "<div style='background: #e3f2fd; border-left: 5px solid #2196f3; padding: 10px; margin: 10px 0;'>";
        echo "<strong>ğŸ” Examen de : $nom</strong><br>";
        echo "<pre>";
        var_dump($variable);
        echo "</pre>";
        echo "</div>";
    }

    public static function pister($message) {
        echo "<div style='background: #fff3e0; border-left: 5px solid #ff9800; padding: 5px; margin: 5px 0;'>";
        echo "ğŸ“ <strong>Piste:</strong> $message";
        echo "</div>";
    }
}

// Utilisons nos outils de dÃ©tective
$monTableau = ["pomme", "banane", "orange"];
DetectiveCode::examiner($monTableau, "Mon panier de fruits");

$monObjet = new stdClass();
$monObjet->nom = "Jean";
$monObjet->age = 25;
DetectiveCode::examiner($monObjet, "Mon objet mystÃ¨re");

DetectiveCode::pister("Je suis Ã  la ligne " . __LINE__);
?>
```

### Les erreurs les plus courantes (et comment les Ã©viter)

#### 1. Le point-virgule oubliÃ©

```php
<?php
// âŒ OUBLIÃ‰
echo "Bonjour"
echo "Monde"

// âœ… CORRECT  
echo "Bonjour";
echo "Monde";
?>
```

#### 2. Les guillemets qui s'embrouillent

```php
<?php
// âŒ MÃ‰LANGÃ‰
echo "Bonjour";

// âœ… CORRECT
echo "Bonjour";
// ou
echo 'Bonjour';
?>
```

#### 3. Les variables qui changent de nom

```php
<?php
// âŒ INCONSISTANT
$utilisateur = "Marie";
echo $Utilisateur;  // âŒ PHP est sensible Ã  la casse !

// âœ… CORRECT  
$utilisateur = "Marie";
echo $utilisateur;  // âœ…
?>
```

---

## ğŸ¯ Atelier pratique : CrÃ©ons un systÃ¨me complet

### ScÃ©nario : Gestion d'une bibliothÃ¨que ğŸ“š

```php
<?php
class Bibliotheque {
    private $livres = [];

    public function ajouterLivre($titre, $pages) {
        try {
            // Validation des donnÃ©es
            if (empty($titre)) {
                throw new InvalidArgumentException("ğŸ“ Le titre ne peut pas Ãªtre vide");
            }

            if (!is_numeric($pages) || $pages <= 0) {
                throw new InvalidArgumentException("ğŸ”¢ Le nombre de pages doit Ãªtre positif");
            }

            if ($pages > 10000) {
                throw new RangeException("ğŸ˜® Ce livre est trop volumineux !");
            }

            // Tout est bon, on ajoute le livre
            $this->livres[] = [
                'titre' => $titre,
                'pages' => $pages
            ];

            echo "âœ… Livre '$titre' ajoutÃ© avec succÃ¨s ($pages pages)<br>";

        } catch (InvalidArgumentException $e) {
            echo "<span style='color: red;'>âŒ Erreur: " . $e->getMessage() . "</span><br>";
        } catch (RangeException $e) {
            echo "<span style='color: orange;'>âš ï¸ Attention: " . $e->getMessage() . "</span><br>";
        }
    }

    public function emprunterLivre($titre) {
        try {
            if (empty($this->livres)) {
                throw new RuntimeException("ğŸ“š La bibliothÃ¨que est vide !");
            }

            $trouve = false;
            foreach ($this->livres as $index => $livre) {
                if ($livre['titre'] === $titre) {
                    $trouve = true;
                    unset($this->livres[$index]);
                    echo "âœ… Livre '$titre' empruntÃ© avec succÃ¨s !<br>";
                    break;
                }
            }

            if (!$trouve) {
                throw new OutOfBoundsException("ğŸ” Livre '$titre' non trouvÃ© dans la bibliothÃ¨que");
            }

        } catch (RuntimeException $e) {
            echo "<span style='color: purple;'>" . $e->getMessage() . "</span><br>";
        } catch (OutOfBoundsException $e) {
            echo "<span style='color: blue;'>" . $e->getMessage() . "</span><br>";
        }
    }
}

// Testons notre bibliothÃ¨que
echo "<h2>ğŸ« Gestion de notre bibliothÃ¨que</h2>";

$maBibli = new Bibliotheque();

// Ajout de livres (certains avec erreurs)
$maBibli->ajouterLivre("Harry Potter", 300);     // âœ…
$maBibli->ajouterLivre("", 150);                 // âŒ Titre vide
$maBibli->ajouterLivre("Gros Livre", 15000);     // âŒ Trop de pages
$maBibli->ajouterLivre("Le Petit Prince", 80);   // âœ…

echo "<br>";

// Emprunt de livres
$maBibli->emprunterLivre("Harry Potter");        // âœ…
$maBibli->emprunterLivre("Livre Inconnu");       // âŒ Non trouvÃ©
?>
```

## ğŸ“ RÃ©sumons ce que nous avons appris :

1. **`die()`** â†’ ArrÃªt d'urgence (simple mais brutal)
2. **Gestionnaires personnalisÃ©s** â†’ ContrÃ´le total des erreurs
3. **Try/Catch** â†’ Attraper et gÃ©rer les exceptions Ã©lÃ©gamment
4. **Outils de dÃ©bogage** â†’ Examiner le code comme un dÃ©tective

## ğŸš€ DÃ©fi final :

CrÃ©ez votre propre classe `Restaurant` qui :

- Prend des commandes de plats
- VÃ©rifie que les ingrÃ©dients sont disponibles
- GÃ¨re les erreurs (client veut un plat inexistant, ingrÃ©dient manquant, etc.)

Utilisez tout ce que vous avez appris sur la gestion des erreurs !

**Rappel** : Faites des tests, modifiez le code, cassez-le puis rÃ©parez-le ! C'est comme Ã§a qu'on apprend ğŸ’ª
