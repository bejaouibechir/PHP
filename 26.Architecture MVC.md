

## ğŸ¯ Atelier PÃ©dagogique : MVC & Composer

### **Objectif PÃ©dagogique**

Comprendre la diffÃ©rence entre un chargement manuel des classes et l'utilisation d'un autoloader moderne avec Composer.

---

## ğŸ“š PARTIE 1 : MVC "Ã€ LA MAIN"

### **Contexte pour les Apprenants**

> "Avant Composer, les dÃ©veloppeurs PHP devaient inclure chaque classe manuellement. Voyons comment Ã§a fonctionnait !"

### ğŸ¯ Ã‰tape 1.1 - DÃ©couverte de la Structure

```text
mon-mvc-manuel/
â”œâ”€â”€ public/
â”‚   â””â”€â”€ index.php          â† POINT D'ENTRÃ‰E (expliquer ce concept)
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ Controllers/
â”‚   â”œâ”€â”€ Models/
â”‚   â””â”€â”€ Views/
â””â”€â”€ core/                  â† "MOTEUR" DE NOTRE APPLICATION
```

**ğŸ’¡ Point pÃ©dagogique** : 

- `public/` = interface publique, seule partie accessible par le web
- `core/` = notre "framework maison"
- `app/` = notre code mÃ©tier

### ğŸ¯ Ã‰tape 1.2 - Le ProblÃ¨me du Chargement Manuel

**public/index.php**

```php
<?php
// SCÃ‰NARIO PÃ‰DAGOGIQUE : Le cauchemar des require_once !
// -----------------------------------------------------

echo "<h3>ğŸš§ CHARGEMENT MANUEL - Avant Composer</h3>";
echo "<p>Imaginez devoir inclure CHAQUE classe Ã  la main !</p>";

// 1. On doit connaÃ®tre l'ordre de dÃ©pendance
require_once __DIR__ . '/../core/Controller.php';   // Base d'abord
require_once __DIR__ . '/../core/Router.php';       // Puis le routeur
require_once __DIR__ . '/../app/Models/HomeModel.php'; // ModÃ¨le ensuite
require_once __DIR__ . '/../app/Controllers/HomeController.php'; // ContrÃ´leur enfin

echo "<p>âœ… 4 require_once plus tard... notre app peut dÃ©marrer !</p>";

// 2. Notre application dÃ©marre
$router = new Router();
$router->dispatch();
```

**Discussion** : 

- "Que se passe-t-il si j'oublie un require_once ?"
- "Et si j'ai 50 classes ?"

### ğŸ¯ Ã‰tape 1.3 - Le Routeur "PÃ©dagogique"

**core/Router.php**

```php
<?php
class Router
{
    public function dispatch(): void
    {
        // SCÃ‰NARIO : Comprendre le routing basique
        echo "<div style='background: #f0f0f0; padding: 10px; margin: 10px 0;'>";
        echo "<strong>ğŸ” DEBUG ROUTER :</strong><br>";

        $controllerName = $_GET['controller'] ?? 'home';
        $actionName = $_GET['action'] ?? 'index';

        echo "Controller demandÃ© : <code>{$controllerName}</code><br>";
        echo "Action demandÃ©e : <code>{$actionName}</code><br>";
        echo "</div>";

        // Construction manuelle du nom de classe
        $controllerClass = ucfirst($controllerName) . 'Controller';

        // VÃ‰RIFICATION MANUELLE
        if (!class_exists($controllerClass)) {
            $this->showError("Classe {$controllerClass} introuvable. Avez-vous fait le require_once ?");
            return;
        }

        $controller = new $controllerClass();
        $controller->{$actionName}();
    }

    private function showError(string $message): void
    {
        echo "<div style='border: 2px solid red; padding: 15px; background: #ffe6e6;'>";
        echo "<h3>âŒ Erreur de Routing</h3>";
        echo "<p>{$message}</p>";
        echo "<small>ProblÃ¨me typique du mode manuel : oubli de require_once</small>";
        echo "</div>";
    }
}
```

### ğŸ¯ Ã‰tape 1.4 - Test des ProblÃ¨mes

**Test pÃ©dagogique** : 

1. âœ… AccÃ©der Ã  `public/index.php?controller=home&action=index` â†’ Ã§a marche
2. âŒ Commenter un require_once dans index.php â†’ erreur immÃ©diate
3. ğŸ’¡ Montrer la fragilitÃ© du systÃ¨me

---

## ğŸ”„ TRANSITION PÃ‰DAGOGIQUE

### **"Mais il y a une meilleure faÃ§on !"**

**ProblÃ¨mes identifiÃ©s ensemble** :

1. âŒ Oubli possible de require_once
2. âŒ Ordre de chargement important  
3. âŒ Gestion fastidieuse pour beaucoup de classes
4. âŒ Pas de namespaces = risques de conflits

**Solution** : L'autoloading avec Composer !

---

## ğŸš€ PARTIE 2 : MVC AVEC COMPOSER

### ğŸ¯ Ã‰tape 2.1 - DÃ©couverte de la Nouvelle Structure

```text
mon-mvc-composer/
â”œâ”€â”€ vendor/               â† MAGIE NOIRE ? NON, COMPOSER !
â”œâ”€â”€ public/
â”‚   â””â”€â”€ index.php
â”œâ”€â”€ src/                  â† CODE SOURCE AVEC NAMESPACES
â””â”€â”€ composer.json         â† CONFIGURATION DE COMPOSER
```

### ğŸ¯ Ã‰tape 2.2 - Configuration Composer

**composer.json**

```json
{
    "name": "formation/mvc-moderne",
    "description": "Passage au MVC moderne avec Composer",
    "autoload": {
        "psr-4": {
            "App\\": "src/"
        }
    },
    "require": {}
}
```

**ğŸ’¡ Commande pÃ©dagogique** :

```bash
composer install
```

**Explication** : 

- "Composer a crÃ©Ã© le dossier `vendor/` avec notre autoloader"
- "Plus besoin de require_once, tout est automatique !"

### ğŸ¯ Ã‰tape 2.3 - Le Front Controller SimplifiÃ©

**public/index.php**

```php
<?php
// SCÃ‰NARIO PÃ‰DAGOGIQUE : La magie de l'autoloading
// -------------------------------------------------

echo "<h3>ğŸ‰ AVEC COMPOSER - L'autoloading moderne</h3>";
echo "<p>Une seule ligne pour tout charger !</p>";

// LA SEULE LIGNE MAGIQUE !
require __DIR__ . '/../vendor/autoload.php';

echo "<p>âœ… Autoloader chargÃ© - Toutes nos classes sont disponibles !</p>";

use App\Core\Router;

$router = new Router();
$router->dispatch();
```

### ğŸ¯ Ã‰tape 2.4 - Les Namespaces en Action

**src/Core/Router.php**

```php
<?php
namespace App\Core;

class Router
{
    public function dispatch(): void
    {
        echo "<div style='background: #e6f7ff; padding: 10px; margin: 10px 0;'>";
        echo "<strong>ğŸ” ROUTER AVEC NAMESPACES :</strong><br>";

        $controllerName = $_GET['controller'] ?? 'home';
        $actionName = $_GET['action'] ?? 'index';

        // CONSTRUCTION AVEC NAMESPACE
        $controllerClass = 'App\\Controller\\' . ucfirst($controllerName) . 'Controller';

        echo "Classe complÃ¨te : <code>{$controllerClass}</code><br>";
        echo "</div>";

        if (!class_exists($controllerClass)) {
            $this->showError("Classe {$controllerClass} introuvable - ProblÃ¨me de namespace ?");
            return;
        }

        $controller = new $controllerClass();
        $controller->{$actionName}();
    }
}
```

### ğŸ¯ Ã‰tape 2.5 - Test de la Magie

**Test pÃ©dagogique** :

1. CrÃ©er une nouvelle classe sans la require â†’ Ã§a marche !
2. Montrer l'ajout facile de nouvelles fonctionnalitÃ©s

```php
// src/Model/UserModel.php
namespace App\Model;

class UserModel 
{
    public function getUsers(): array 
    {
        return ['Alice', 'Bob', 'Charlie'];
    }
}

// src/Controller/UserController.php  
namespace App\Controller;

use App\Core\Controller;
use App\Model\UserModel;

class UserController extends Controller
{
    public function list(): void
    {
        $model = new UserModel();
        $users = $model->getUsers();

        $this->render('user_list', ['users' => $users]);
    }
}
```

**ğŸ’¡ Test immÃ©diat** : 
`public/index.php?controller=user&action=list` â†’ Ã§a marche sans modifier index.php !

---

## ğŸ“Š TABLEAU COMPARATIF (Exercice avec les Apprenants)

| Aspect                 | Sans Composer           | Avec Composer        |
| ---------------------- | ----------------------- | -------------------- |
| **Chargement classes** | require_once manuel     | Autoload automatique |
| **Nouvelle classe**    | Modifier index.php      | Rien Ã  faire !       |
| **Organisation**       | Pas de namespaces       | Namespaces clairs    |
| **DÃ©pendances**        | TÃ©lÃ©chargement manuel   | `composer require`   |
| **Ã‰quipe**             | Complexe Ã  synchroniser | `composer install`   |

---

## ğŸ¯ EXERCICE PRATIQUE GUIDÃ‰

### **Mission** : Ajouter une page "About"

**Consignes** :

1. â±ï¸ ChronomÃ©trer le temps pour chaque version
2. ğŸ“ Noter les Ã©tapes nÃ©cessaires

**Version Manuel** :

```php
// 1. CrÃ©er AboutModel (require ?)
// 2. CrÃ©er AboutController (require ?)  
// 3. Modifier index.php (ajouter 2 require_once)
// 4. Tester
```

**Version Composer** :

```php
// 1. CrÃ©er AboutModel dans src/Model/
// 2. CrÃ©er AboutController dans src/Controller/  
// 3. Tester directement !
```

**ğŸ’¡ RÃ©sultat** : La version Composer est 3x plus rapide !

---

## ğŸ” ACTIVITÃ‰ D'ANALYSE

### **Questionnaire de RÃ©flexion**

1. **Qu'arrive-t-il si vous ajoutez 10 nouvelles classes dans chaque version ?**
2. **Comment gÃ©rez-vous les conflits de noms sans namespaces ?**
3. **Quel systÃ¨me prÃ©fÃ©rez-vous pour un gros projet ? Pourquoi ?**

### **DÃ©buggage GuidÃ©**

ScÃ©narios Ã  rÃ©soudre en groupe :

- "La classe n'est pas trouvÃ©e" â†’ VÃ©rifier le namespace
- "ProblÃ¨me d'autoload" â†’ `composer dump-autoload`
- "Route qui ne fonctionne pas" â†’ Analyser la construction du FQCN

---

## ğŸ BONUS PÃ‰DAGOGIQUE

### **Visualisation de l'Autoloading**

CrÃ©ez un fichier **autoload_visualizer.php** :

```php
<?php
require 'vendor/autoload.php';

echo "<h3>ğŸ” CARTE DE L'AUTOLOADING</h3>";

$autoloader = include 'vendor/autoload.php';
echo "<pre>";
print_r($autoloader->getClassMap());
echo "</pre>";
```

### **Transition Progressive**

Montrez comment migrer progressivement :

1. Commencer avec Composer pour les nouvelles classes
2. Garder l'ancien systÃ¨me pour l'existant
3. Migrer progressivement

---

Cette version est beaucoup plus pÃ©dagogique car elle :
âœ… Met en scÃ¨ne les problÃ¨mes concrets
âœ… Montre les solutions Ã©tape par Ã©tape  
âœ… Propose des exercices pratiques
âœ… Encourage la rÃ©flexion comparative
âœ… Rend tangible les bÃ©nÃ©fices de Composer
