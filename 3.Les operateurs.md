# Atelier PHP — Opérateurs

## Objectifs

- Manipuler **tous** les opérateurs PHP (arithmétiques, comparaison, logiques, assignation, chaînes, tableaux, conditionnels, spread, null coalescing, spaceship).

- Comprendre **précédence** et **associativité** par l’exemple.

- Savoir **tester** chaque concept en CLI.

## Pré-requis (rapide)

- PHP **8.2+** installé (`php -v`).

- Un dossier de travail vide (ex: `php-ops-lab`).

- Exécuter chaque fichier par : `php nom_du_fichier.php`.

> Astuce : Tous les scripts sont commentés. Explications **au-dessus**, commentaires **dans le code**.

---

## 1) Opérateurs arithmétiques

**But** : pratiquer `+ - * / % **` et l’auto-incrément/décrément en pré/post.

**Créer le fichier `s01_arithmetique.php` :**

```php
<?php
// Objectif : démontrer les opérateurs arithmétiques de base et les effets pré/post ++/--
// Exécution : php s01_arithmetique.php

$a = 42;
$b = 20;

echo "== Opérations de base ==\n";
echo "\$a + \$b = " . ($a + $b) . "\n";    // 62
echo "\$a - \$b = " . ($a - $b) . "\n";    // 22
echo "\$a * \$b = " . ($a * $b) . "\n";    // 840
echo "\$a / \$b = " . ($a / $b) . "\n";    // 2.1
echo "\$a % \$b = " . ($a % $b) . "\n";    // 2
echo "\$a ** 2 = " . ($a ** 2) . "\n";     // 1764 (puissance)

// Pré/post incrément/décrément : différence visible
$count = 10;
echo "\n== Pré/Post ++/-- ==\n";
echo "Initial: \$count={$count}\n";        // 10
echo "Post++ : " . $count++ . "\n";        // affiche 10, puis $count=11
echo "Après Post++ : {$count}\n";          // 11
echo "Pré++  : " . ++$count . "\n";        // incrémente d'abord (12), puis affiche 12
echo "Post-- : " . $count-- . "\n";        // affiche 12, puis $count=11
echo "Pré--  : " . --$count . "\n";        // décrémente d'abord (10), puis affiche 10

// Flottants et négatifs
$x = -10; $y = 5.5;
echo "\n== Flottants & négatifs ==\n";
printf("Addition: %.1f\n", $x + $y);       // -4.5
printf("Division: %.2f\n", $x / $y);       // -1.82...
```

**Exécuter & vérifier :**

```bash
php s01_arithmetique.php
```

---

## 2) Opérateurs de comparaison

**But** : pratiquer `== === != !== < <= > >= <=>` et voir booléens.

**Créer le fichier `s02_comparaison.php` :**

```php
<?php
// Objectif : comparer valeurs & types ; utiliser spaceship <=> ; afficher booléens clairement
// Exécution : php s02_comparaison.php

$a = 42; $b = 20;

echo "== Booléens lisibles ==\n";
$show = fn($label, $bool) => printf("%-22s: %s\n", $label, $bool ? 'true' : 'false');

$show('$a == $b', $a == $b);
$show('$a === $b', $a === $b);
$show('$a != $b', $a != $b);
$show('$a !== $b', $a !== $b);
$show('$a > $b', $a > $b);
$show('$a < $b', $a < $b);
$show('$a >= $b', $a >= $b);
$show('$a <= $b', $a <= $b);

echo "\n== == vs === ==\n";
$x = 15; $y = "15";
$show('15 == "15"', $x == $y);   // true (valeur)
$show('15 === "15"', $x === $y); // false (type diff.)

echo "\n== Spaceship <=> ==\n";
// -1 (gauche < droite) ; 0 (égal) ; 1 (gauche > droite)
printf("5 <=> 10/2 = %d\n", 5 <=> (10/2));  // 0
printf("4 <=> 10/2 = %d\n", 4 <=> (10/2));  // -1
printf("7 <=> 10/2 = %d\n", 7 <=> (10/2));  // 1

echo "\n== Spaceship sur chaînes ==\n";
echo "\"bat\" <=> \"ball\" = " . ("bat" <=> "ball") . "\n"; // 1
echo "\"bat\" <=> \"baz\"  = " . ("bat" <=> "baz")  . "\n"; // -1
```

**Exécuter :**

```bash
php s02_comparaison.php
```

---

## 3) Opérateurs logiques

**But** : pratiquer `&& || ! and or` et observer la **précédence** (`and/or` < `&&/||`).

**Créer le fichier `s03_logiques.php` :**

```php
<?php
// Objectif : combiner conditions ; illustrer precedence and/or vs &&/||
// Exécution : php s03_logiques.php

$a = 1; $b = 0;

echo "== De base ==\n";
echo ($a && $b) ? "a&&b true\n" : "a&&b false\n"; // false
echo ($a || $b) ? "a||b true\n" : "a||b false\n"; // true
echo (!$a) ? "!a true\n" : "!a false\n";          // false

echo "\n== and/or vs &&/|| ==\n";
// Attention : precedence différente sur l'affectation
$res = false;
$res = true && false; // && a une forte priorité
var_export($res); echo " (true && false)\n"; // false

$res = false;
$res = true and false; // équivaut à: ($res = true) and false
var_export($res); echo " (true and false, affectation + precedence)\n"; // true

// Cas pratique
$age = 25; $isMember = true;
echo "\n== Cas pratique ==\n";
echo ($age >= 18 && $isMember) ? "Réduction OK\n" : "Réduction NON\n";
echo ($age < 18 || !$isMember) ? "Condition spéciale\n" : "RAS\n";
```

**Exécuter :**

```bash
php s03_logiques.php
```

---

## 4) Opérateurs d’assignation

**But** : pratiquer `= += -= *= /= %= **= ??=` et bitwise `&= |= ^= <<= >>=`.

**Créer le fichier `s04_assignation.php` :**

```php
<?php
// Objectif : mise à jour concise des variables ; y compris bitwise et ??=
// Exécution : php s04_assignation.php

$c = 10;
echo "Start c={$c}\n";

$c += 5;   echo "c += 5  => {$c}\n";  // 15
$c -= 3;   echo "c -= 3  => {$c}\n";  // 12
$c *= 2;   echo "c *= 2  => {$c}\n";  // 24
$c /= 4;   echo "c /= 4  => {$c}\n";  // 6
$c %= 4;   echo "c %= 4  => {$c}\n";  // 2
$c **= 3;  echo "c **= 3 => {$c}\n";  // 8

echo "\n== Bitwise assign ==\n";
$n = 0b0101;             // 5
$n &= 0b0110; echo "n&=6 => {$n}\n";     // 4
$n |= 0b0001; echo "n|=1 => {$n}\n";     // 5
$n ^= 0b0011; echo "n^=3 => {$n}\n";     // 6
$n <<= 1;     echo "n<<=1=> {$n}\n";     // 12
$n >>= 2;     echo "n>>=2=> {$n}\n";     // 3

echo "\n== Null coalesce assign ??= ==\n";
$opt = null;
$opt ??= 'defaut';        // si $opt est null, affecte 'defaut'
echo "\$opt => {$opt}\n";
```

**Exécuter :**

```bash
php s04_assignation.php
```

---

## 5) Opérateurs de chaînes

**But** : pratiquer `.` et `.=` + interpolation, boucles de concaténation.

**Créer le fichier `s05_chaines.php` :**

```php
<?php
// Objectif : concaténer, accumuler, interpoler proprement
// Exécution : php s05_chaines.php

$x = "Hello";
$y = "PHP";
$z = $x . " " . $y;         // concaténation
echo $z . "\n";             // Hello PHP

$msg = "Compteur: ";
for ($i=1; $i<=3; $i++) {
    $msg .= $i . " ";       // accumulateur via .=
}
echo $msg . "\n";           // Compteur: 1 2 3

$name = "Ankit"; $age = 25;
echo "My name is {$name} and I am {$age} years old.\n"; // interpolation
```

**Exécuter :**

```bash
php s05_chaines.php
```

---

## 6) Opérateurs de tableaux (array)

**But** : pratiquer **union** `+`, égalité/identité `== ===`, différences `!= !== <>`.

**Créer le fichier `s06_tableaux.php` :**

```php
<?php
// Objectif : union +, égalité/identité, inégalité
// Exécution : php s06_tableaux.php

$arr1 = ["phy"=>70, "che"=>80, "math"=>90];
$arr2 = ["Eng"=>70, "Bio"=>80, "CompSci"=>90];

echo "== Union (+) ==\n";
$arr3 = $arr1 + $arr2;      // clés de gauche prévalent
var_dump($arr3);

echo "\n== Egalité vs Identité ==\n";
$a = [0=>70, 2=>80, 1=>90];
$b = [70, 90, 80];
var_dump($a == $b);   // true : même paires clé/valeur
var_dump($a === $b);  // false : ordre/clefs diff.

echo "\n== Identité stricte ==\n";
$c = [0=>70,1=>80,2=>90];
$d = [70,80,90];
var_dump($c === $d);  // true : même ordre / valeurs / clés indexées

echo "\n== Inégalité !=, !==, <> ==\n";
$e = ["a"=>1,"b"=>"2","c"=>3];
$f = ["a"=>1,"b"=>2,"c"=>3];
var_dump($e != $f);   // true (types diff.)
var_dump($e !== $f);  // true (identité non)
var_dump($e <> $f);   // true (alias de !=)
```

**Exécuter :**

```bash
php s06_tableaux.php
```

---

## 7) Opérateur conditionnel (ternaire)

**But** : écrire des expressions concises `condition ? A : B` + ternaires imbriqués **raisonnables**.

**Créer le fichier `s07_ternaire.php` :**

```php
<?php
// Objectif : choisir une valeur selon condition ; limiter l'imbrication
// Exécution : php s07_ternaire.php [nombre]

$a = 10; $b = 20;
$result = ($a > $b) ? $a : $b;
echo "Max(a,b) = {$result}\n";

$num = (int)($argv[1] ?? 15);
$parite = ($num % 2 === 0) ? "Even" : "Odd";
echo "Number {$num} is {$parite}\n";

// Ternaires imbriqués (utiliser avec prudence)
$sign = ($num > 0) ? "Positive" : (($num < 0) ? "Negative" : "Zero");
echo "Sign({$num}) = {$sign}\n";
```

**Exécuter :**

```bash
php s07_ternaire.php 5
```

---

## 8) Null coalescing `??` (et chaînage) + rappel ternaire vs `isset`

**But** : récupérer une valeur “si définie/non nulle”, sinon un **fallback**.

**Créer le fichier `s08_null_coalescing.php` :**

```php
<?php
// Objectif : démontrer ?? et chaînage ; alternative au ternaire avec isset()
// Exécution : php s08_null_coalescing.php

// Simuler des sources (GET/POST simulés)
$_GET = []; $_POST = ['name' => 'Amar'];

$username = $_GET['name'] ?? $_POST['name'] ?? 'Guest';
echo "Welcome {$username}\n";

// Equivalents avec isset() ? : (moins lisible)
$username2 = isset($_GET['name']) ? $_GET['name'] : (isset($_POST['name']) ? $_POST['name'] : 'Guest');
echo "Welcome {$username2}\n";
```

**Exécuter :**

```bash
php s08_null_coalescing.php
```

---

## 9) Spread operator `...` (tableaux & fonctions)

**But** : **dépaqueter** des tableaux dans d’autres, composer proprement, variadiques, **named args**.

**Créer le fichier `s09_spread.php` :**

```php
<?php
// Objectif : utiliser ... pour arrays et fonctions ; combiner avec arguments nommés (PHP 8)
// Exécution : php s09_spread.php

echo "== Unpacking arrays ==\n";
$a1 = [1,2,3]; $a2 = [4,5];
$merged = [...$a1, ...$a2];
print_r($merged);

echo "\n== array_merge vs spread ==\n";
$merged2 = array_merge($a1, $a2);
print_r($merged2);

// Variadique côté fonction
function sumAll(...$nums) {
    // Somme tous les arguments passés
    return array_sum($nums);
}
echo "\nSum variadique : " . sumAll(...[1,2,3], 4, 5) . "\n";

// Mélange spread + arguments nommés
function format3($x, $y, $z=30) {
    return "x=$x y=$y z=$z";
}
echo "format3(...[10,20], z:50) => " . format3(...[10,20], z:50) . "\n";

// Unpack à partir d'une fonction
function squares(int $n): array {
    $out = [];
    for ($i=0; $i<$n; $i++) $out[] = $i**2;
    return $out;
}
$copy = [...squares(5)];
print_r($copy);
```

**Exécuter :**

```bash
php s09_spread.php
```

---

## 10) Précédence & associativité (pièges courants)

**But** : voir l’ordre d’évaluation, parenthèses, différence `and` vs `&&`.

**Créer le fichier `s10_precedence.php` :**

```php
<?php
// Objectif : montrer l'effet de la précédence et associativité
// Exécution : php s10_precedence.php

echo "== Arithmétique ==\n";
echo "2 + 6 / 3 = " . (2 + 6 / 3) . "\n";    // 4
echo "(2 + 6) / 3 = " . ((2 + 6) / 3) . "\n"; // 2.666...

echo "\n== Non associatifs ==\n";
// Exemple illustratif : certains opérateurs de même priorité ne s'enchaînent pas (éviter ambigüités)

echo "\n== and/or vs &&/|| sur affectation ==\n";
$res = false;
$res = true && false; // false
var_dump($res);

$res = false;
$res = true and false; // var_dump(true), car affectation avant and
var_dump($res);

// Conclusion : toujours préférer && et || avec affectations, ou parenthéser.
```

**Exécuter :**

```bash
php s10_precedence.php
```

---

## 11) Exercices guidés (courts, concrets)

> Règle : écrivez votre solution, testez-la, puis comparez avec la **correction**.

### Exo 1 — Calculatrice simple (arithmétique)

- **But** : lire deux nombres en CLI et afficher `+ - * / %`.

- **Attendu** : gérer division par zéro proprement.

**Créer le fichier `exo01_calc.php` :**

```php
<?php
// Usage : php exo01_calc.php 42 20
[$script, $A, $B] = $argv + [null, null, null];
if (!is_numeric($A) || !is_numeric($B)) {
    fwrite(STDERR, "Usage: php exo01_calc.php <a> <b>\n");
    exit(1);
}
$a = $A + 0; $b = $B + 0;
echo "$a + $b = " . ($a + $b) . "\n";
echo "$a - $b = " . ($a - $b) . "\n";
echo "$a * $b = " . ($a * $b) . "\n";
echo "$a % $b = " . ($b != 0 ? $a % $b : 'NaN(div0)') . "\n";
echo "$a / $b = " . ($b != 0 ? ($a / $b) : 'Inf(div0)') . "\n";
```

**Tester :**

```bash
php exo01_calc.php 42 20
php exo01_calc.php 7 0
```

---

### Exo 2 — Filtrage logique (logiques + comparaison)

- **But** : un produit est en promo si `prix > 100 || (stock < 10 && is_member)`.

- **Attendu** : afficher `PROMO` ou `PAS DE PROMO`.

**Créer le fichier `exo02_promo.php` :**

```php
<?php
// Usage : php exo02_promo.php <prix> <stock> <is_member:0|1>
[$s,$prix,$stock,$m] = $argv + [null,null,null,0];
$prix = (float)$prix; $stock = (int)$stock; $isMember = (bool)$m;

$promo = ($prix > 100) || ($stock < 10 && $isMember);
echo $promo ? "PROMO\n" : "PAS DE PROMO\n";
```

**Tester :**

```bash
php exo02_promo.php 120 50 0
php exo02_promo.php 90 5 1
php exo02_promo.php 90 12 1
```

---

### Exo 3 — Nettoyage entrée (?? et ??=)

- **But** : récupérer `$argv[1]` sinon `DEFAULT`, et stocker dans `$name`.

- **Attendu** : utiliser `??` et `??=`.

**Créer le fichier `exo03_coalesce.php` :**

```php
<?php
$input = $argv[1] ?? null;
$name ??= ($input ?? 'DEFAULT');
echo "Name={$name}\n";
```

**Tester :**

```bash
php exo03_coalesce.php Bechir
php exo03_coalesce.php
```

---

### Exo 4 — Merge config (spread + union)

- **But** : fusionner une config base + overrides.

- **Attendu** : montrer `+` (préserve clés de gauche) vs spread `[...$a, ...$b]` (droite prend le pas).

**Créer le fichier `exo04_merge.php` :**

```php
<?php
$base = ['host'=>'localhost','port'=>3306,'debug'=>false];
$over = ['port'=>5432,'debug'=>true];

echo "Union (+) => clés base préservent\n";
var_dump($base + $over);

echo "\nSpread => overrides appliqués\n";
$merged = [...$base, ...$over];
var_dump($merged);
```

**Tester :**

```bash
php exo04_merge.php
```

---

### Exo 5 — Tri custom (spaceship)

- **But** : trier un tableau d’objets par `price` puis `name`.

- **Attendu** : utiliser `<=>`.

**Créer le fichier `exo05_sort.php` :**

```php
<?php
$items = [
    (object)['name'=>'B','price'=>10],
    (object)['name'=>'A','price'=>10],
    (object)['name'=>'C','price'=>5],
];

usort($items, function($l, $r) {
    // d’abord par price, puis par name
    return ($l->price <=> $r->price) ?: ($l->name <=> $r->name);
});

foreach ($items as $it) {
    echo "{$it->price} - {$it->name}\n";
}
```

**Tester :**

```bash
php exo05_sort.php
```

---

### Exo 6 — Générateur de phrase (chaînes + assignations)

- **But** : construire une phrase “Number i” de 1 à N.

- **Attendu** : utiliser `.=` et une boucle.

**Créer le fichier `exo06_phrase.php` :**

```php
<?php
$N = (int)($argv[1] ?? 5);
$out = "";
for ($i=1; $i<=$N; $i++) {
    $out .= "Number {$i}\n";
}
echo $out;
```

**Tester :**

```bash
php exo06_phrase.php 3
```

---

### Exo 7 — Sécurité precedence (and/or)

- **But** : comprendre l’impact de `and/or` avec `=`.

- **Attendu** : prouver la différence avec `&&/||`.

**Créer le fichier `exo07_and_or.php` :**

```php
<?php
$res = false;
$res = true && false;  // false
var_dump($res);

$res = false;
$res = true and false; // true (piège precedence)
var_dump($res);

// Solution : parenthéser ou utiliser &&/||
```

**Tester :**

```bash
php exo07_and_or.php
```

---

### Exo 8 — Variadique + named args (spread)

- **But** : fonction `rect(w,h,unit='px')` + appel via spread/named.

- **Attendu** : `rect(...[100,50], unit:'%')`.

**Créer le fichier `exo08_rect.php` :**

```php
<?php
function rect(int $w, int $h, string $unit='px'): string {
    return "{$w}{$unit} x {$h}{$unit}";
}
echo rect(...[100,50], unit:'%') . "\n"; // 100% x 50%
```

**Tester :**

```bash
php exo08_rect.php
```

---

## 12) Conseils & pièges

- **Toujours** parenthéser si un doute de **précédence**.

- Préférer `&&` et `||` avec **affectations**, éviter `and/or`.

- `==` compare **valeur**, `===` compare **valeur + type** (privilégier `===`).

- `+` sur tableaux : **préserve** les clés existantes de gauche. Pour **override**, utiliser spread `[...]`.

- `??` évite les ternaires verbeux avec `isset()`.

- Limiter les ternaires **imbriqués** : lisibilité d’abord.
