# Atelier PHP ‚Äî Gestion des Fichiers et Flux

## Objectifs

- Manipuler des fichiers : ouvrir, lire, √©crire, copier, supprimer.

- D√©couvrir les flux `stdin`, `stdout`, `stderr`.

- Apprendre √† g√©rer erreurs, r√©pertoires et formats (CSV, JSON).

- Produire du code s√ªr, clair et r√©utilisable.

---

## 1Ô∏è‚É£ Ouvrir et fermer un fichier

**Cr√©er le fichier `s01_open_close.php` :**

```php
<?php
// Objectif : ouvrir un fichier existant et v√©rifier l'ouverture
// Ex√©cution : php s01_open_close.php

$filename = "demo.txt";
$file = fopen($filename, "w"); // cr√©e ou √©crase

if (!$file) {
    die("Erreur : impossible d'ouvrir $filename\n");
}
fwrite($file, "Bonjour PHP\n");
fclose($file);
echo "Fichier $filename cr√©√© et ferm√© avec succ√®s.\n";
?>
```

**R√©sultat attendu :**

```
Fichier demo.txt cr√©√© et ferm√© avec succ√®s.
```

---

## 2Ô∏è‚É£ Lire un fichier ligne par ligne

**Cr√©er `s02_read_lines.php` :**

```php
<?php
// Objectif : lecture ligne par ligne avec fgets()
// Ex√©cution : php s02_read_lines.php

$file = fopen("demo.txt", "r");
if (!$file) die("Fichier introuvable.\n");

while (($line = fgets($file)) !== false) {
    echo ">> $line";
}
fclose($file);
?>
```

**R√©sultat attendu :**

```
>> Bonjour PHP
```

---

## 3Ô∏è‚É£ Lire caract√®re par caract√®re

**Cr√©er `s03_read_char.php` :**

```php
<?php
// Objectif : lecture caract√®re par caract√®re avec fgetc()
// Ex√©cution : php s03_read_char.php

$file = fopen("demo.txt", "r");
if (!$file) die("Erreur d'ouverture\n");

while (($c = fgetc($file)) !== false) {
    echo $c;
}
fclose($file);
?>
```

---

## 4Ô∏è‚É£ Lire tout un fichier d‚Äôun coup

**Cr√©er `s04_read_all.php` :**

```php
<?php
// Objectif : lire le contenu complet d'un fichier en une fois
// Ex√©cution : php s04_read_all.php

$content = file_get_contents("demo.txt");
echo "Contenu du fichier :\n$content";
?>
```

---

## 5Ô∏è‚É£ √âcrire dans un fichier (√©crasement)

**Cr√©er `s05_write.php` :**

```php
<?php
// Objectif : √©crire un texte et le sauvegarder
// Ex√©cution : php s05_write.php

$fp = fopen("note.txt", "w");
fwrite($fp, "Premi√®re ligne.\nDeuxi√®me ligne.\n");
fclose($fp);
echo "Contenu √©crit dans note.txt\n";
?>
```

---

## 6Ô∏è‚É£ Ajouter du texte √† la fin d‚Äôun fichier

**Cr√©er `s06_append.php` :**

```php
<?php
// Objectif : ajouter du texte √† la fin sans √©craser
// Ex√©cution : php s06_append.php

$file = fopen("note.txt", "a");
fwrite($file, "Troisi√®me ligne ajout√©e.\n");
fclose($file);
echo "Ligne ajout√©e √† note.txt\n";
?>
```

---

## 7Ô∏è‚É£ Copier un fichier ligne par ligne

**Cr√©er `s07_copy.php` :**

```php
<?php
// Objectif : copier un fichier en ajoutant un pr√©fixe √† chaque ligne
// Ex√©cution : php s07_copy.php

$src = fopen("note.txt", "r");
$dst = fopen("copie.txt", "w");

while (!feof($src)) {
    $line = fgets($src);
    fputs($dst, ">> $line");
}
fclose($src);
fclose($dst);
echo "Copie termin√©e avec succ√®s.\n";
?>
```

---

## 8Ô∏è‚É£ Lire un CSV proprement

**Cr√©er `s08_csv_read.php` :**

```php
<?php
// Objectif : lire un fichier CSV et afficher en tableau HTML
// Ex√©cution : php s08_csv_read.php

$fp = fopen("clients.csv", "r");
echo "<table border='1'>\n";
while ($row = fgetcsv($fp, 1000, ";")) {
    echo "<tr><td>" . implode("</td><td>", $row) . "</td></tr>\n";
}
echo "</table>";
fclose($fp);
?>
```

**Exemple de `clients.csv` :**

```
Nom;Email;Ville
Marie;marie@mail.com;Paris
Ali;ali@mail.com;Tunis
```

---

## 9Ô∏è‚É£ Cr√©er, renommer, supprimer, permissions

**Cr√©er `s09_manage_files.php` :**

```php
<?php
// Objectif : manipuler les fichiers et droits
// Ex√©cution : php s09_manage_files.php

// Cr√©er un fichier temporaire
file_put_contents("temp.txt", "Donn√©es temporaires");

// Renommer
rename("temp.txt", "archive.txt");

// Copier
copy("archive.txt", "archive.bak");

// Supprimer
unlink("archive.bak");

// Changer permissions (sous Linux)
@chmod("archive.txt", 0644);

echo "Fichier renomm√© et backup supprim√©.\n";
?>
```

---

## üîü Gestion des dossiers

**Cr√©er `s10_directories.php` :**

```php
<?php
// Objectif : cr√©er, lister et supprimer des dossiers
// Ex√©cution : php s10_directories.php

mkdir("data/logs", 0755, true); // cr√©e r√©cursivement

echo "Contenu du dossier courant :\n";
$files = scandir(".");
foreach ($files as $f) {
    if ($f != "." && $f != "..") echo "- $f\n";
}

// Supprime un dossier vide
if (is_dir("data/logs")) {
    rmdir("data/logs");
    echo "Dossier data/logs supprim√©.\n";
}
?>
```





---

## 1Ô∏è‚É£ Gestion d‚Äôerreurs d‚Äôouverture

**Cr√©er `s11_error_handling.php` :**

```php
<?php
// Objectif : g√©rer proprement les erreurs d'ouverture
// Ex√©cution : php s11_error_handling.php

$file = @fopen("inexistant.txt", "r");
if (!$file) {
    echo "Erreur : fichier inexistant.\n";
} else {
    fclose($file);
}
?>
```

---

## 2Ô∏è‚É£ Liste des flux support√©s

**Cr√©er `s12_streams.php` :**

```php
<?php
// Objectif : afficher les wrappers de flux disponibles
// Ex√©cution : php s12_streams.php

print_r(stream_get_wrappers());
?>
```

**R√©sultat attendu :**

```
Array
(
   [0] => php
   [1] => file
   [2] => http
   [3] => ftp
   ...
)
```

---

## 3Ô∏è‚É£ Lire depuis stdin (console)

**Cr√©er `s13_stdin.php` :**

```php
<?php
// Objectif : lire une entr√©e clavier (mode CLI uniquement)
// Ex√©cution : php s13_stdin.php

echo "Votre nom ? ";
$name = trim(fgets(STDIN));
echo "Bonjour, $name !\n";
?>
```

---

## 4Ô∏è‚É£ Sauvegarder des donn√©es JSON

**Cr√©er `s14_json.php` :**

```php
<?php
// Objectif : √©crire et lire un fichier JSON
// Ex√©cution : php s14_json.php

$data = ["nom" => "Nadia", "age" => 30, "langues" => ["PHP", "Python"]];
file_put_contents("profil.json", json_encode($data, JSON_PRETTY_PRINT));

// Lecture
$json = file_get_contents("profil.json");
$profil = json_decode($json, true);

echo "Utilisateur : {$profil['nom']} - Age : {$profil['age']}\n";
?>
```

---

## 5Ô∏è‚É£ Exemple complet : mini logger applicatif

**Cr√©er `exo_logger.php` :**

```php
<?php
// Objectif : cr√©er un journal d‚Äô√©v√©nements simple
// Ex√©cution : php exo_logger.php "Message √† consigner"

$logDir = "logs";
$logFile = "$logDir/app.log";

if (!is_dir($logDir)) mkdir($logDir);

$msg = $argv[1] ?? "Aucun message";
$entry = date("Y-m-d H:i:s") . " - $msg\n";

file_put_contents($logFile, $entry, FILE_APPEND);
echo "Log ajout√© dans $logFile\n";

// Lecture
echo "\nContenu actuel du journal :\n";
echo file_get_contents($logFile);
?>
```

**Ex√©cuter :**

```bash
php exo_logger.php "Application d√©marr√©e"
```

---

## 6Ô∏è‚É£ Lecture structur√©e avec `fscanf()`

**Cr√©er `s16_fscanf.php` :**

```php
<?php
// Objectif : lire des valeurs format√©es (comme scanf en C)
// Ex√©cution : php s16_fscanf.php

// Fichier exemple employees.txt :
/*
Ravishankar    ravi@gmail.com    Manager    40000
Kavita    kavita@hotmail.com    Assistant    25000
*/

$fp = fopen("employees.txt", "r");
while ($row = fscanf($fp, "%s\t%s\t%s\t%d\n")) {
    list($name, $email, $post, $salary) = $row;
    echo "$name ($email) - $post : $salary EUR\n";
}
fclose($fp);
?>
```

---

## 7Ô∏è‚É£ Exercice final ‚Äî mini gestionnaire de fichiers

**Cr√©er `exo_file_manager.php` :**

```php
<?php
// Objectif : menu CLI pour manipuler des fichiers
// Ex√©cution : php exo_file_manager.php

function menu() {
    echo "\n=== Gestionnaire de Fichiers ===\n";
    echo "1. Cr√©er un fichier\n";
    echo "2. Lire un fichier\n";
    echo "3. Supprimer un fichier\n";
    echo "0. Quitter\n> ";
}

while (true) {
    menu();
    $choice = trim(fgets(STDIN));

    switch ($choice) {
        case "1":
            echo "Nom du fichier : ";
            $name = trim(fgets(STDIN));
            echo "Contenu : ";
            $content = trim(fgets(STDIN));
            file_put_contents($name, $content);
            echo "Fichier $name cr√©√©.\n";
            break;

        case "2":
            echo "Nom du fichier √† lire : ";
            $name = trim(fgets(STDIN));
            if (file_exists($name))
                echo "Contenu de $name :\n" . file_get_contents($name) . "\n";
            else
                echo "Fichier inexistant.\n";
            break;

        case "3":
            echo "Nom du fichier √† supprimer : ";
            $name = trim(fgets(STDIN));
            if (file_exists($name)) {
                unlink($name);
                echo "Supprim√©.\n";
            } else echo "Inexistant.\n";
            break;

        case "0":
            exit("Fin du programme.\n");

        default:
            echo "Choix invalide.\n";
    }
}
?>
```

---

## Conseils finaux

- Fermez **tous les pointeurs** avec `fclose()` pour √©viter les fuites.

- Pr√©f√©rez `file_get_contents()` / `file_put_contents()` pour les fichiers courts.

- V√©rifiez toujours les droits d‚Äô√©criture sur le dossier (`chmod`, `chown`).

- Utilisez `JSON` ou `CSV` pour le stockage structur√©.

- Prot√©gez les acc√®s avec `.htaccess` ou permissions restreintes.
